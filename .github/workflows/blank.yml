name: Build First Android Kernel

on:
  push:
    branches:
      - main # Or your preferred branch

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up build environment
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential libncurses-dev flex bison git ccache bc libssl-dev dwarves

    - name: Download Toolchain (e.g., Clang)
      run: |
        # Example for Proton Clang, replace with your preferred toolchain
        git clone https://github.com/kdrag0n/proton-clang.git --depth=1 ~/toolchain
        export PATH="$HOME/toolchain/bin:$PATH"

    - name: Configure Kernel
      run: |
        export ARCH=arm
        export SUBARCH=arm
        export KBUILD_BUILD_USER="GitHubActions"
        export KBUILD_BUILD_HOST="github-runner"
        make a02_defconfig

    - name: Build Kernel
      run: |
        export ARCH=arm
        export SUBARCH=arm
        export KBUILD_BUILD_USER="GitHubActions"
        export KBUILD_BUILD_HOST="github-runner"
        make -j$(nproc) # Or specify number of jobs

    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: kernel-boot-image
        path: arch/arm/boot/Image.gz-dtb # Or the path to your compiled boot image
